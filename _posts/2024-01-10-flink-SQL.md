---
layout: post
title: Airflow automatization
---

Apache Flink is powerful streaming 

They have awesome documentation

Yet some reasonable features requires ad-hoc. I'll share you with some of my favorite.

## Field unpacking

```sql

```

## Work with array



## Difficult calculations.

Calculations are better perfomed sequentialy

Haversine formula is used for calculating distance between two points defined by latitude and longitude.

This formula is especially in geo-streaming applications.

Exact formula is given by: 

$$
2 r \arcsin\left(\sqrt{\sin^2(\frac{\phi_1-\phi_2}{2}) + \cos \phi_1 \cos \phi_2 \sin^2 (\frac{\lambda_2-\lambda_1}{2})}\right)
$$

It's really difficult to

I advise you to use chaining for facilitation of your work.

```sql
power(sin(locationLng1-locationLng2) * 3.14/360.,2) AS dlng,
power(sin(locationLat1-locationLat2)* 3.14/360.,2) AS dlat,
cos(locationLat1 * 3.14/ 180.) AS cos_loc1,
cos(locationLat2 * 3.14/ 180.) AS cos_loc2,
```

I multiply by `3.14/180.` to convert gradus for radians. Earth radius ðŸŒŽ is approximately 6371 km.
So final distance will be 

```sql
2*6371*asin(sqrt(dlat+cos_loc1*cos_loc2*dlng))
```

## Use of Cassandra

Flink provides

Not all tables can b

[](https://cassandra.apache.org/_/index.html)


## Deduplication

First of all you need to know about time in Flink
There are three types:
- **Processing time**: 
- **Event time**":
- **Ingestion time**: time when event was *ingested* to operator

Also you need to know more about time windows in [Flink](https://nightlies.apache.org/flink/flink-docs-release-1.14/docs/dev/datastream/operators/windows/)



Yet a lot of 